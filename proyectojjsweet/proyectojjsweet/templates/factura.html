<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura</title>

  {% if pdf %}
  <!-- üîπ Estilos b√°sicos para PDF con xhtml2pdf -->
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      margin: 20px;
    }
    .factura {
      width: 100%;
      border: 1px solid #000;
      padding: 10px;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #000;
      padding: 5px;
      text-align: center;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
  {% else %}
  <!-- üîπ Estilos modernos solo para web -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px 15px;
      min-height: 100vh;
      text-align: center;
    }
    .factura {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      border: 2px solid #333;
      border-radius: 10px;
      background: #fff;
    }
    .factura h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f4f4f4;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
    .acciones {
      margin-top: 20px;
      text-align: center;
    }
    .acciones button,
    .acciones a {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      text-decoration: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .acciones button {
      background: #28a745;
    }
    .acciones button:hover {
      background: #218838;
    }
    .acciones a {
      background: #0d72e6;
    }
    .acciones a:hover {
      background: #1d07df;
    }
  </style>
  {% endif %}
</head>
<body>
<div id="facturaPDF" class="factura">
    <h2>Factura</h2>
    <p><b>Cliente:</b> {{ cliente }}</p>
    <p><b>Documento:</b> {{ documento }}</p>
    <p><b>Tel√©fono:</b> {{ telefono }}</p>
    <p><b>Correo:</b> {{ correo }}</p>
    <p><b>Direcci√≥n:</b> {{ direccion }}</p>
    <p><b>Fecha y hora:</b> {{ venta.ven_fecha.strftime('%d/%m/%Y %H:%M:%S') }}</p>

    <table>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Total parcial</th>
      </tr>
      {% for detalle in detalles %}
      <tr>
        <td>{{ detalle.prod_nombre }}</td>
        <td>{{ detalle.dv_cantidad }}</td>
        <td>${{ "%.2f"|format(detalle.dv_precio_uni) }}</td>
        <td>${{ "%.2f"|format(detalle.dv_total) }}</td>
      </tr>
      {% endfor %}
    </table>

    <p class="total">TOTAL: ${{ "%.2f"|format(venta.ven_total) }}</p>
</div>

{% if not pdf %}
<!-- üîπ Botones solo visibles en web -->
<div class="acciones">
    <button id="btnPDF">üñ®Ô∏è Descargar PDF</button>
    <a href="{{ url_for('ventas') }}">‚¨Ö Volver a Ventas</a>
    <a href="{{ url_for('historial') }}" style="margin-left:20px;">üìú Ver Historial</a>
</div>

<!-- Librer√≠as solo para web -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
document.getElementById("btnPDF").addEventListener("click", () => {
    const { jsPDF } = window.jspdf;
    const factura = document.getElementById("facturaPDF");

    html2canvas(factura, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");

        const imgWidth = 190;
        const pageHeight = 295;
        const imgHeight = canvas.height * imgWidth / canvas.width;

        let heightLeft = imgHeight;
        let position = 10;

        pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, "PNG", 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        pdf.save(`factura_${Date.now()}.pdf`);
    });
});
</script>
{% endif %}
</body>
</html>


